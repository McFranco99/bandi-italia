<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>BandiPerTe.it – Bandi, incentivi e finanziamenti per imprese e startup</title>
  <meta name="description" content="Trova rapidamente bandi, incentivi e finanziamenti pubblici per imprese, startup e professionisti. Filtra per regione, ente e scadenza. Aggiornamento continuo." />
  <link rel="canonical" href="https://www.bandiperte.it/" />
  <meta name="robots" content="index, follow" />

  <!-- AdSense -->
  <meta name="google-adsense-account" content="ca-pub-1105644281066553">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1105644281066553" crossorigin="anonymous"></script>

  <!-- Open Graph -->
  <meta property="og:title" content="BandiPerTe.it – Tutti i bandi in un unico posto" />
  <meta property="og:description" content="Aggregatore nazionale di bandi e incentivi: filtra per regione, ente e scadenza. Aggiornato in tempo reale." />
  <meta property="og:url" content="https://www.bandiperte.it/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://www.bandiperte.it/og-image.jpg" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="BandiPerTe.it – Tutti i bandi in un unico posto" />
  <meta name="twitter:description" content="Trova bandi, incentivi e finanziamenti per imprese e startup." />
  <meta name="twitter:image" content="https://www.bandiperte.it/og-image.jpg" />

  <!-- JSON-LD: WebSite + SearchAction -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"BandiPerTe",
    "url":"https://www.bandiperte.it/",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://www.bandiperte.it/?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <style>
  :root {
    --color-white: rgba(255, 255, 255, 1);
    --color-black: rgba(0, 0, 0, 1);
    --color-cream-50: rgba(252, 252, 249, 1);
    --color-cream-100: rgba(255, 255, 253, 1);
    --color-gray-200: rgba(245, 245, 245, 1);
    --color-gray-300: rgba(167, 169, 169, 1);
    --color-gray-400: rgba(119, 124, 124, 1);
    --color-slate-500: rgba(98, 108, 113, 1);
    --color-brown-600: rgba(94, 82, 64, 1);
    --color-charcoal-700: rgba(31, 33, 33, 1);
    --color-charcoal-800: rgba(38, 40, 40, 1);
    --color-slate-900: rgba(19, 52, 59, 1);
    --color-teal-300: rgba(50, 184, 198, 1);
    --color-teal-400: rgba(45, 166, 178, 1);
    --color-teal-500: rgba(33, 128, 141, 1);
    --color-teal-600: rgba(29, 116, 128, 1);
    --color-teal-700: rgba(26, 104, 115, 1);
    --color-red-400: rgba(255, 84, 89, 1);
    --color-red-500: rgba(192, 21, 47, 1);
    --color-orange-400: rgba(230, 129, 97, 1);
    --color-orange-500: rgba(168, 75, 47, 1);
    --color-brown-600-rgb: 94, 82, 64;
    --color-teal-500-rgb: 33, 128, 141;
    --color-slate-900-rgb: 19, 52, 59;
    --color-slate-500-rgb: 98, 108, 113;
    --color-background: var(--color-cream-50);
    --color-surface: var(--color-cream-100);
    --color-text: var(--color-slate-900);
    --color-text-secondary: var(--color-slate-500);
    --color-primary: var(--color-teal-500);
    --color-primary-hover: var(--color-teal-600);
    --color-primary-active: var(--color-teal-700);
    --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
    --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
    --color-border: rgba(var(--color-brown-600-rgb), 0.2);
    --color-btn-primary-text: var(--color-cream-50);
    --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
    --color-success: var(--color-teal-500);
    --color-error: var(--color-red-500);
    --color-warning: var(--color-orange-500);
    --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --font-size-sm: 12px;
    --font-size-base: 14px;
    --font-size-md: 14px;
    --font-size-lg: 16px;
    --font-size-xl: 18px;
    --font-size-2xl: 20px;
    --font-size-3xl: 24px;
    --font-size-4xl: 30px;
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-semibold: 550;
    --font-weight-bold: 600;
    --space-4: 4px;
    --space-8: 8px;
    --space-12: 12px;
    --space-16: 16px;
    --space-20: 20px;
    --space-24: 24px;
    --space-32: 32px;
    --radius-sm: 6px;
    --radius-base: 8px;
    --radius-md: 10px;
    --radius-lg: 12px;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
    --duration-fast: 150ms;
    --duration-normal: 250ms;
    --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-gray-400-rgb: 119, 124, 124;
      --color-teal-300-rgb: 50, 184, 198;
      --color-gray-300-rgb: 167, 169, 169;
      --color-gray-200-rgb: 245, 245, 245;
      --color-background: var(--color-charcoal-700);
      --color-surface: var(--color-charcoal-800);
      --color-text: var(--color-gray-200);
      --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
      --color-primary: var(--color-teal-300);
      --color-primary-hover: var(--color-teal-400);
      --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
      --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
      --color-border: rgba(var(--color-gray-400-rgb), 0.3);
      --color-error: var(--color-red-400);
      --color-success: var(--color-teal-300);
      --color-warning: var(--color-orange-400);
      --color-btn-primary-text: var(--color-slate-900);
      --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    }
  }

  /* Base reset */
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { scroll-behavior: smooth; }
  body {
    font-family: var(--font-family-base);
    background: linear-gradient(180deg, rgba(33,128,141,0.06), rgba(255,255,255,0)) no-repeat,
                var(--color-background);
    color: var(--color-text);
    line-height: 1.5;
    font-size: var(--font-size-base);
    text-rendering: optimizeLegibility;
  }
  body.no-scroll { overflow: hidden; }

  /* Header migliorato (mantiene colori) */
  .header {
    background:
      linear-gradient(180deg, rgba(var(--color-teal-500-rgb), 0.08), rgba(0,0,0,0) 60%),
      var(--color-surface);
    backdrop-filter: saturate(1.1);
    border-bottom: 1px solid var(--color-card-border);
    padding: var(--space-24) var(--space-16);
    box-shadow: var(--shadow-sm);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header-content { max-width: 1200px; margin: 0 auto; display:flex; align-items:center; justify-content:space-between; gap:16px; }
  .logo {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    letter-spacing: .2px;
    display:flex; align-items:center; gap:10px;
  }
  .logo::after{
    content:"•";
    color: var(--color-primary);
    opacity:.5;
    font-weight: var(--font-weight-bold);
    transform: translateY(-1px);
  }
  .tagline { font-size: var(--font-size-base); color: var(--color-text-secondary); }

  /* Mini nav opzionale (senza registrazione) */
  .top-actions { display:flex; align-items:center; gap:10px; }
  .pill {
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 12px; border-radius: 999px;
    background: var(--color-secondary);
    color: var(--color-text);
    font-size: var(--font-size-sm);
    border: 1px solid var(--color-card-border);
    box-shadow: var(--shadow-sm);
    user-select:none;
  }

  .container { max-width: 1200px; margin: 0 auto; padding: var(--space-24) var(--space-16); }

  /* Hero leggero (stessi colori) */
  .hero {
    margin-top: 8px;
    background:
      radial-gradient(1200px 300px at 50% -50px, rgba(var(--color-teal-500-rgb),0.10), transparent 60%),
      var(--color-surface);
    border: 1px solid var(--color-card-border);
    border-radius: 16px;
    padding: 20px 18px;
    box-shadow: var(--shadow-sm);
    display:flex; align-items:center; justify-content:space-between; gap:18px;
  }
  .hero h2{
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text);
  }
  .hero p{
    color: var(--color-text-secondary);
    margin-top: 6px;
  }

  /* Filtri (effetto glass leggero) */
  .filters {
    background: linear-gradient(180deg, rgba(255,255,255,.7), rgba(255,255,255,.85));
    border: 1px solid var(--color-card-border);
    border-radius: var(--radius-lg);
    padding: var(--space-24);
    margin: var(--space-24) 0 var(--space-32);
    box-shadow: var(--shadow-sm);
  }
  @media (prefers-color-scheme: dark) {
    .filters { background: rgba(0,0,0,.3); backdrop-filter: blur(3px); }
  }
  .filters h2 {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--space-16);
    color: var(--color-text);
  }
  .filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-16);
    margin-bottom: var(--space-16);
  }
  .filter-group { display: flex; flex-direction: column; gap: var(--space-8); }
  .filter-label { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); color: var(--color-text); }
  .filter-select, .search-input {
    padding: var(--space-8) var(--space-12);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    background-color: var(--color-background);
    color: var(--color-text);
    font-size: var(--font-size-base);
    transition: border-color var(--duration-fast) var(--ease-standard), box-shadow var(--duration-fast) var(--ease-standard), transform var(--duration-fast) var(--ease-standard);
  }
  .filter-select:focus, .search-input:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(var(--color-teal-500-rgb), .15); }
  .filter-select:hover, .search-input:hover { transform: translateY(-1px); }

  .search-box { display: flex; gap: var(--space-12); margin-top: var(--space-16); }
  .search-input { flex: 1; }

  .btn {
    padding: var(--space-8) var(--space-20);
    border: none;
    border-radius: 12px;
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    cursor: pointer;
    transition: transform var(--duration-fast) var(--ease-standard), box-shadow var(--duration-fast) var(--ease-standard), background-color var(--duration-normal) var(--ease-standard);
    will-change: transform;
  }
  .btn:active { transform: translateY(0); }
  .btn-primary {
    background: linear-gradient(180deg, rgba(var(--color-teal-500-rgb), 1), rgba(var(--color-teal-500-rgb), .9));
    color: var(--color-btn-primary-text);
    box-shadow: 0 6px 16px rgba(var(--color-teal-500-rgb), .20);
  }
  .btn-primary:hover { background: var(--color-primary-hover); transform: translateY(-1px); box-shadow: 0 10px 22px rgba(var(--color-teal-500-rgb), .25); }
  .btn-secondary {
    background-color: var(--color-secondary);
    color: var(--color-text);
    border: 1px solid var(--color-card-border);
  }
  .btn-secondary:hover { background-color: var(--color-secondary-hover); transform: translateY(-1px); }

  /* Stats */
  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-16);
    margin-bottom: var(--space-32);
  }
  .stat-card {
    background: var(--color-surface);
    border: 1px solid var(--color-card-border);
    border-radius: var(--radius-lg);
    padding: var(--space-20);
    text-align: center;
    box-shadow: var(--shadow-sm);
    transition: transform .2s var(--ease-standard), box-shadow .2s var(--ease-standard);
  }
  .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
  .stat-number {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-primary);
    margin-bottom: var(--space-8);
  }
  .stat-label { font-size: var(--font-size-base); color: var(--color-text-secondary); }

  /* Card bandi */
  .bandi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--space-24);
  }
  .bando-card {
    background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,1));
    border: 1px solid var(--color-card-border);
    border-radius: var(--radius-lg);
    padding: var(--space-24);
    box-shadow: var(--shadow-sm);
    transition: all var(--duration-normal) var(--ease-standard);
    display: flex;
    flex-direction: column;
    animation: fadeUp .45s var(--ease-standard) both;
    cursor: pointer;
  }
  @media (prefers-color-scheme: dark){
    .bando-card { background: rgba(0,0,0,.2); }
  }
  .bando-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }
  .bando-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--space-16);
    gap: var(--space-12);
  }
  .bando-category {
    display: inline-block;
    padding: var(--space-4) var(--space-12);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
  }
  .category-immobili { background-color: rgba(59, 130, 246, 0.15); color: #1d4ed8; border: 1px solid rgba(59, 130, 246, 0.3); }
  .category-imprese { background-color: rgba(34, 197, 94, 0.15); color: #15803d; border: 1px solid rgba(34, 197, 94, 0.3); }
  .category-lavoro { background-color: rgba(168, 85, 247, 0.15); color: #6b21a8; border: 1px solid rgba(168, 85, 247, 0.3); }
  .category-generale { background-color: rgba(245, 158, 11, 0.15); color: #b45309; border: 1px solid rgba(245, 158, 11, 0.3); }

  .bando-status {
    padding: var(--space-4) var(--space-12);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    white-space: nowrap;
  }
  .status-aperto { background-color: rgba(var(--color-teal-500-rgb), 0.15); color: var(--color-success); border: 1px solid rgba(var(--color-teal-500-rgb), 0.25); }
  .status-scadenza { background-color: rgba(245, 158, 11, 0.15); color: var(--color-warning); border: 1px solid rgba(245, 158, 11, 0.3); }
  .status-chiuso { background-color: rgba(var(--color-slate-500-rgb), 0.15); color: var(--color-text-secondary); border: 1px solid rgba(var(--color-slate-500-rgb), 0.25); }

  .bando-title { font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-text); margin-bottom: var(--space-12); line-height: 1.3; }
  .bando-ente { font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--space-16); font-weight: var(--font-weight-medium); }
  .bando-description { font-size: var(--font-size-base); color: var(--color-text); margin-bottom: var(--space-16); line-height: 1.6; flex: 1; }

  .bando-details {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
    padding-top: var(--space-16);
    border-top: 1px solid var(--color-card-border);
  }
  .bando-detail-item { display: flex; justify-content: space-between; font-size: var(--font-size-sm); }
  .detail-label { color: var(--color-text-secondary); font-weight: var(--font-weight-medium); }
  .detail-value { color: var(--color-text); font-weight: var(--font-weight-semibold); }

  .bando-actions { display: flex; gap: var(--space-8); margin-top: var(--space-16); }
  .btn-small { padding: var(--space-8) var(--space-16); font-size: var(--font-size-sm); flex: 1; }

  .no-results {
    text-align: center;
    padding: var(--space-32);
    color: var(--color-text-secondary);
    font-size: var(--font-size-lg);
  }

  /* Footer */
  .footer {
    background-color: var(--color-surface);
    border-top: 1px solid var(--color-card-border);
    padding: var(--space-32) var(--space-16);
    margin-top: var(--space-32);
  }
  .footer-content { max-width: 1200px; margin: 0 auto; text-align: center; }
  .footer-text { color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--space-16); }
  .footer-links { display: flex; justify-content: center; gap: var(--space-24); flex-wrap: wrap; }
  .footer-link { color: var(--color-primary); text-decoration: none; font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); transition: color var(--duration-fast) var(--ease-standard); }
  .footer-link:hover { color: var(--color-primary-hover); }

  /* Animazioni */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(6px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* Accessibilità */
  :focus-visible {
    outline: 3px solid rgba(var(--color-teal-500-rgb), .35);
    outline-offset: 2px;
    border-radius: 10px;
  }

  @media (max-width: 768px) {
    .header-content { flex-direction: column; align-items:flex-start; gap:6px; }
    .hero { flex-direction: column; align-items: flex-start; }
    .bandi-grid { grid-template-columns: 1fr; }
    .filter-grid { grid-template-columns: 1fr; }
    .stats { grid-template-columns: repeat(2, 1fr); }
  }

  /* ===== Drawer (sidebar) a destra + overlay ===== */
  .drawer-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.35);
    opacity: 0;
    visibility: hidden;
    transition: opacity .3s var(--ease-standard), visibility .3s var(--ease-standard);
    z-index: 999;
  }
  .drawer-overlay.open {
    opacity: 1;
    visibility: visible;
  }
  .drawer {
    position: fixed;
    right: 0;
    top: 0;
    height: 100%;
    width: min(560px, 40vw);
    max-width: 100%;
    background: var(--color-surface);
    color: var(--color-text);
    border-left: 1px solid var(--color-card-border);
    box-shadow: -8px 0 24px rgba(0,0,0,.12);
    transform: translateX(100%);
    transition: transform .3s var(--ease-standard);
    z-index: 1000;
    display: flex;
    flex-direction: column;
  }
  .drawer.open { transform: translateX(0); }
  .drawer-header {
    display:flex; align-items:center; gap:10px; padding:16px; border-bottom:1px solid var(--color-card-border);
    position: sticky; top:0; background: var(--color-surface); z-index:1;
  }
  .drawer-title {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    line-height: 1.2;
    flex: 1;
  }
  .drawer-body {
    padding: 16px;
    overflow: auto;
  }
  .drawer-footer {
    padding: 16px;
    border-top: 1px solid var(--color-card-border);
    display:flex; gap:8px;
    position: sticky; bottom: 0; background: var(--color-surface);
  }
  .btn-linklike {
    background: transparent;
    border: 1px solid var(--color-card-border);
    color: var(--color-text);
  }
  .badge {
    display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; border:1px solid var(--color-card-border);
    background: var(--color-secondary);
  }
  .drawer-details {
    display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin: 12px 0 16px;
  }
  .drawer-details .item {
    background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,1));
    border: 1px solid var(--color-card-border);
    border-radius: 10px; padding: 10px;
  }
  .drawer-details .label { font-size: 12px; color: var(--color-text-secondary); }
  .drawer-details .value { font-weight: var(--font-weight-semibold); }
  @media (prefers-color-scheme: dark){
    .drawer-details .item { background: rgba(0,0,0,.2); }
  }
  @media (max-width: 768px) {

  /* Layout base */
  body {
    font-size: 15px;
    padding: 0;
  }

  .header-content {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
  }

  .hero {
    flex-direction: column;
    align-items: flex-start;
    text-align: left;
    padding: 16px;
  }

  .filters {
    padding: 16px 12px;
  }

  .filter-grid {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  /* ✅ Risolve il problema del pulsante Reset fuori schermo */
  .search-box {
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
  }

  .search-input {
    width: 100%;
    font-size: 16px;
  }

  .btn {
    width: 100%;
    text-align: center;
    padding: 12px;
    border-radius: 10px;
  }

  .stats {
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .bando-card {
    padding: 18px;
    border-radius: 12px;
  }

  /* Miglioramento leggibilità cards */
  .bando-title {
    font-size: 18px;
  }

  /* Drawer ottimizzato per mobile (slide dal basso come un'app) */
  .drawer {
    width: 100%;
    height: 90%;
    bottom: 0;
    top: auto;
    border-left: none;
    border-top: 1px solid var(--color-card-border);
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    transform: translateY(100%);
    transition: transform 0.3s var(--ease-standard);
  }

  .drawer.open {
    transform: translateY(0);
  }

  .drawer-footer {
    flex-direction: column;
    gap: 10px;
  }

  .drawer-footer .btn {
    width: 100%;
  }
}
  </style>
</head>
<body>
<header class="header">
  <div class="header-content">
    <div>
      <h1 class="logo">🇮🇹 Bandi Per Te</h1>
      <p class="tagline">Aggregatore nazionale di bandi per immobili, imprese, lavoro e investimenti</p>
    </div>
    <div class="top-actions" aria-hidden="true">
      <span class="pill">Nessuna registrazione richiesta</span>
    </div>
  </div>
</header>

<main class="container" id="mainContent" aria-live="polite">
  <!-- Hero leggero e informativo -->
  <section class="hero" aria-label="Introduzione">
    <div>
      <h2>Tutti i bandi, in un unico posto</h2>
      <p>Filtra per categoria, regione, ente e stato di apertura. Interfaccia semplice, aggiornamento continuo.</p>
    </div>
  </section>

  <section class="filters">
    <h2>Filtra i bandi</h2>
    <div class="filter-grid">
      <div class="filter-group">
        <label class="filter-label" for="categoria">Categoria</label>
        <select id="categoria" class="filter-select">
          <option value="">Tutte le categorie</option>
          <option value="immobili">Immobili</option>
          <option value="imprese">Imprese e Investimenti</option>
          <option value="lavoro">Lavoro e Concorsi</option>
          <option value="generale">Generale</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label" for="regione">Regione</label>
        <select id="regione" class="filter-select">
          <option value="">Tutte le regioni</option>
          <option value="nazionale">Nazionale</option>
          <option value="piemonte">Piemonte</option>
          <option value="lombardia">Lombardia</option>
          <option value="veneto">Veneto</option>
          <option value="emilia-romagna">Emilia-Romagna</option>
          <option value="toscana">Toscana</option>
          <option value="lazio">Lazio</option>
          <option value="campania">Campania</option>
          <option value="sicilia">Sicilia</option>
          <option value="altre">Altre regioni</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label" for="stato">Stato</label>
        <select id="stato" class="filter-select">
          <option value="">Tutti gli stati</option>
          <option value="aperto">Aperto</option>
          <option value="scadenza">In scadenza</option>
          <option value="chiuso">Chiuso</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label" for="ente">Ente</label>
        <select id="ente" class="filter-select">
          <option value="">Tutti gli enti</option>
          <option value="demanio">Agenzia del Demanio</option>
          <option value="mimit">MIMIT</option>
          <option value="regione">Regioni</option>
          <option value="invitalia">Invitalia</option>
          <option value="inpa">INPA</option>
          <option value="altro">Altri enti</option>
        </select>
      </div>
    </div>
    <div class="search-box">
      <input
        type="text"
        id="searchInput"
        class="search-input"
        placeholder="Cerca per parola chiave (es. 'digitale', 'casa montagna', 'startup')..."
      />
      <button class="btn btn-primary" onclick="applicaFiltri()">Cerca</button>
      <button class="btn btn-secondary" onclick="resetFiltri()">Reset</button>
    </div>
  </section>

  <section class="stats">
    <div class="stat-card">
      <div class="stat-number" id="totaleBandi">0</div>
      <div class="stat-label">Bandi totali</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="bandiAperti">0</div>
      <div class="stat-label">Bandi aperti</div>
    </div>
    <div class="stat-card">
      <div class="stat-number" id="scadenzaImminente">0</div>
      <div class="stat-label">In scadenza</div>
    </div>
  </section>

  <section id="bandiContainer" class="bandi-grid no-results" aria-label="Elenco bandi">Nessun bando trovato.</section>
</main>

<footer class="footer">
  <div class="footer-content">
    <p class="footer-text">
      Bandi Italia - Aggregatore nazionale di bandi e incentivi • Aggiornato al 25 ottobre 2025
    </p>
    <div class="footer-links">
      <a href="https://www.agenziademanio.it" class="footer-link" target="_blank" rel="noopener noreferrer">Agenzia del Demanio</a>
      <a href="https://www.mimit.gov.it" class="footer-link" target="_blank" rel="noopener noreferrer">MIMIT</a>
      <a href="https://www.inpa.gov.it" class="footer-link" target="_blank" rel="noopener noreferrer">INPA</a>
      <a href="https://www.invitalia.it" class="footer-link" target="_blank" rel="noopener noreferrer">Invitalia</a>
    </div>
  </div>
</footer>

<!-- Overlay e Drawer (sidebar a destra) -->
<div class="drawer-overlay" id="drawerOverlay" aria-hidden="true"></div>
<aside class="drawer" id="drawer" aria-hidden="true" aria-labelledby="drawerTitle" role="dialog">
  <div class="drawer-header">
    <button class="btn btn-linklike" id="btnBackToList" title="Torna ai bandi">← Torna ai bandi</button>
    <h3 class="drawer-title" id="drawerTitle">Dettaglio bando</h3>
  </div>
  <div class="drawer-body" id="drawerContent">
    <!-- Contenuto dinamico -->
  </div>
  <div class="drawer-footer">
    <a id="drawerVisitLink" class="btn btn-primary" href="#" target="_blank" rel="noopener noreferrer">Vai al bando</a>
    <button class="btn btn-secondary" id="btnCloseDrawer">Chiudi</button>
  </div>
</aside>

<script>
const API_URL = "https://www.bandiperte.it/api/bandi";

let tuttiBandi = [];
let bandiFiltrati = [];
let drawerIndexCorrente = null;

function getCategoriaLabel(cat) {
  const labels = {
    immobili: "Immobili",
    imprese: "Imprese e Investimenti",
    lavoro: "Lavoro e Concorsi",
    generale: "Generale"
  };
  return labels[cat] || cat || "N/D";
}
function getStatoLabel(stato) {
  const labels = { aperto: "Aperto", scadenza: "In scadenza", chiuso: "Chiuso" };
  return labels[stato] || stato || "N/D";
}
function getRegioneLabel(regione) {
  const labels = {
    nazionale: "Nazionale", piemonte: "Piemonte", lombardia: "Lombardia",
    veneto: "Veneto", "emilia-romagna": "Emilia-Romagna", toscana: "Toscana",
    lazio: "Lazio", campania: "Campania", sicilia: "Sicilia", altre: "Altre regioni"
  };
  return labels[regione] || regione || "N/D";
}
function matchEnteFilter(enteCompleto, filtroEnte) {
  const mappingEnti = {
    demanio: ["demanio"], mimit: ["mimit"], regione: ["regione"],
    invitalia: ["invitalia"], inpa: ["inpa"]
  };
  if (filtroEnte === "altro") {
    return !Object.values(mappingEnti).flat().some(keyword =>
      (enteCompleto || "").toLowerCase().includes(keyword));
  }
  const keywords = mappingEnti[filtroEnte] || [];
  return keywords.some(keyword => (enteCompleto || "").toLowerCase().includes(keyword));
}
function aggiornaStatistiche() {
  document.getElementById("totaleBandi").textContent = bandiFiltrati.length;
  document.getElementById("bandiAperti").textContent = bandiFiltrati.filter(b => (b.stato || b.status) === "aperto").length;
  document.getElementById("scadenzaImminente").textContent = bandiFiltrati.filter(b => (b.stato || b.status) === "scadenza").length;
}

/* ---------- RENDER LISTA ---------- */
function renderBandi(bandi) {
  const container = document.getElementById("bandiContainer");
  if (!bandi.length) {
    container.classList.add('no-results');
    container.innerHTML = '<div class="no-results">Nessun bando trovato con i filtri selezionati.</div>';
    return;
  }
  container.classList.remove('no-results');

  container.innerHTML = bandi.map((bando, idx) => {
    const titolo = bando.titolo || bando.title || "Bando senza titolo";
    const categoriaKey = bando.categoria || bando.category || "generale";
    const categoria = getCategoriaLabel(categoriaKey);
    const statoKey = bando.stato || bando.status || "aperto";
    const stato = getStatoLabel(statoKey);
    const ente = bando.ente || bando.entity || "N/D";
    const descrizione = bando.descrizione || bando.description || "Nessuna descrizione disponibile";
    const regione = getRegioneLabel(bando.regione || bando.region);
    const scadenza = bando.scadenza || bando.deadline || "N/D";
    const importo = (bando.importo ?? bando.amount);
    const importoView = (importo === undefined || importo === null || importo === "" ) ? "N/D" : importo;
    const link = (bando.link || bando.url || "#").replace(/^http:\/\//i, "https://");

    return `
      <article class="bando-card" data-index="${idx}" tabindex="0" aria-label="Apri dettaglio bando: ${titolo}">
        <div class="bando-header">
          <span class="bando-category category-${categoriaKey}">${categoria}</span>
          <span class="bando-status status-${statoKey}">${stato}</span>
        </div>
        <h3 class="bando-title">${titolo}</h3>
        <div class="bando-ente">🏛️ ${ente}</div>
        <p class="bando-description">${descrizione}</p>
        <div class="bando-details">
          <div class="bando-detail-item"><span class="detail-label">Regione</span><span class="detail-value">${regione}</span></div>
          <div class="bando-detail-item"><span class="detail-label">Scadenza</span><span class="detail-value">${scadenza}</span></div>
          <div class="bando-detail-item"><span class="detail-label">Importo</span><span class="detail-value">${importoView}</span></div>
        </div>
        <div class="bando-actions">
          <button class="btn btn-secondary btn-small js-apri-dettaglio" data-index="${idx}" aria-label="Dettagli bando">Dettagli</button>
          <a class="btn btn-primary btn-small" href="${link}" target="_blank" rel="noopener noreferrer">Vai al bando</a>
        </div>
      </article>
    `;
  }).join('');

  // Delego il click/Enter per aprire il drawer
  container.addEventListener('click', onCardClick);
  container.addEventListener('keydown', onCardKeydown);
}

function onCardClick(e) {
  // se clicco su bottone "Dettagli"
  const btn = e.target.closest('.js-apri-dettaglio');
  if (btn && btn.dataset.index !== undefined) {
    openDrawer(parseInt(btn.dataset.index, 10));
    return;
  }
  // se clicco su card (ma non su link)
  const card = e.target.closest('.bando-card');
  if (card && !e.target.closest('a')) {
    const idx = parseInt(card.dataset.index, 10);
    openDrawer(idx);
  }
}

function onCardKeydown(e) {
  if (e.key === 'Enter') {
    const card = e.target.closest('.bando-card');
    if (card) {
      const idx = parseInt(card.dataset.index, 10);
      openDrawer(idx);
    }
  }
}

/* ---------- FILTRI ---------- */
function applicaFiltri() {
  const categoria = document.getElementById("categoria").value;
  const regione = document.getElementById("regione").value;
  const stato = document.getElementById("stato").value;
  const ente = document.getElementById("ente").value;
  const searchTerm = document.getElementById("searchInput").value.toLowerCase();
  bandiFiltrati = tuttiBandi.filter(bando => {
    const matchCategoria = !categoria || (bando.categoria || bando.category) === categoria;
    const matchRegione = !regione || (bando.regione || bando.region) === regione;
    const matchStato = !stato || (bando.stato || bando.status) === stato;
    const matchEnte = !ente || matchEnteFilter(bando.ente || bando.entity || "", ente);
    const matchSearch =
      !searchTerm ||
      (bando.titolo || bando.title || "").toLowerCase().includes(searchTerm) ||
      (bando.descrizione || bando.description || "").toLowerCase().includes(searchTerm) ||
      (bando.ente || bando.entity || "").toLowerCase().includes(searchTerm);
    return matchCategoria && matchRegione && matchStato && matchEnte && matchSearch;
  });
  aggiornaStatistiche();
  renderBandi(bandiFiltrati);
}
function resetFiltri() {
  document.getElementById("categoria").value = "";
  document.getElementById("regione").value = "";
  document.getElementById("stato").value = "";
  document.getElementById("ente").value = "";
  document.getElementById("searchInput").value = "";
  bandiFiltrati = [...tuttiBandi];
  aggiornaStatistiche();
  renderBandi(bandiFiltrati);
}

/* ---------- LOAD DATI ---------- */
async function caricaBandi() {
  const container = document.getElementById("bandiContainer");
  try {
    console.log("[caricaBandi] richiesta a:", API_URL);
    const res = await fetch(API_URL);
    console.log("[caricaBandi] status:", res.status, res.statusText);
    if (!res.ok) throw new Error("API non disponibile: " + res.status);
    const data = await res.json();
    console.log("[caricaBandi] dati ricevuti dalla API:", data);

    // Accetta sia array puro che oggetto { bandi: [...] } o { items: [...] }
    const items = Array.isArray(data) ? data : (data.bandi || data.items || []);
    if (!items || items.length === 0) {
      console.warn("[caricaBandi] API ritorna array vuoto o campo 'bandi'/'items' mancante.");
    }

    // Fallback extra: se non arriva niente dall’API ma esiste il DB locale nel file
    const list = (items && items.length) ? items : (typeof bandiDatabase !== "undefined" ? bandiDatabase : []);

    tuttiBandi = list.map(b => ({
      ...b,
      // normalizzazioni e fallback campi
      titolo: b.titolo || b.title || "Bando senza titolo",
      categoria: b.categoria || b.category || "generale",
      regione: b.regione || b.region || "nazionale",
      ente: (b.ente || b.entity || b.source || "altro"),
      scadenza: b.scadenza || b.deadline || "N/D",
      importo: (b.importo ?? b.amount ?? 0),
      link: b.link || b.url || "#",
      stato: b.stato || b.status || "aperto",
      descrizione: b.descrizione || b.description || ""
    }));

    bandiFiltrati = [...tuttiBandi];
    aggiornaStatistiche();
    renderBandi(bandiFiltrati);

    if (!tuttiBandi.length) {
      container.innerHTML = '<div class="no-results">Nessun bando trovato. Controlla la console (network) e verifica che lo scraping abbia scritto i dati nell\'API o nel file locale.</div>';
    }
  } catch (e) {
    console.error("[caricaBandi] errore:", e);
    if (typeof bandiDatabase !== "undefined") {
      tuttiBandi = bandiDatabase.map(b => ({
        ...b,
        titolo: b.titolo || b.title || "Bando senza titolo",
        categoria: b.categoria || b.category || "generale",
        regione: b.regione || b.region || "nazionale",
        ente: (b.ente || b.entity || b.source || "altro"),
        scadenza: b.scadenza || b.deadline || "N/D",
        importo: (b.importo ?? b.amount ?? 0),
        link: b.link || b.url || "#",
        stato: b.stato || b.status || "aperto",
        descrizione: b.descrizione || b.description || ""
      }));
      bandiFiltrati = [...tuttiBandi];
      aggiornaStatistiche();
      renderBandi(bandiFiltrati);
    } else {
      container.innerHTML = `<div class="no-results">Errore caricamento bandi: ${e.message}. Apri la console (F12) per dettagli.</div>`;
    }
  }
}

/* ---------- DRAWER (DETTAGLIO) ---------- */
const drawer = document.getElementById('drawer');
const drawerOverlay = document.getElementById('drawerOverlay');
const drawerContent = document.getElementById('drawerContent');
const drawerVisitLink = document.getElementById('drawerVisitLink');
const btnBackToList = document.getElementById('btnBackToList');
const btnCloseDrawer = document.getElementById('btnCloseDrawer');

function openDrawer(index) {
  if (index == null || isNaN(index)) return;
  const b = bandiFiltrati[index];
  if (!b) return;

  drawerIndexCorrente = index;

  const titolo = b.titolo || b.title || "Bando senza titolo";
  const ente = b.ente || b.entity || "N/D";
  const descrizione = b.descrizione || b.description || "Nessuna descrizione disponibile";
  const categoria = getCategoriaLabel(b.categoria || b.category || "generale");
  const stato = getStatoLabel(b.stato || b.status || "aperto");
  const regione = getRegioneLabel(b.regione || b.region);
  const scadenza = b.scadenza || b.deadline || "N/D";
  const importo = (b.importo ?? b.amount);
  const importoView = (importo === undefined || importo === null || importo === "" ) ? "N/D" : importo;
  const link = (b.link || b.url || "#").replace(/^http:\/\//i, "https://");

  document.getElementById('drawerTitle').textContent = titolo;
  drawerContent.innerHTML = `
    <div style="display:flex; align-items:center; gap:8px; margin-bottom:10px;">
      <span class="badge">${categoria}</span>
      <span class="badge">${stato}</span>
    </div>
    <div class="drawer-details">
      <div class="item"><div class="label">Ente</div><div class="value">${ente}</div></div>
      <div class="item"><div class="label">Regione</div><div class="value">${regione}</div></div>
      <div class="item"><div class="label">Scadenza</div><div class="value">${scadenza}</div></div>
      <div class="item"><div class="label">Importo</div><div class="value">${importoView}</div></div>
    </div>
    <div class="item" style="border: 1px solid var(--color-card-border); border-radius: 10px; padding: 12px;">
      <div class="label" style="margin-bottom:6px;">Descrizione</div>
      <div>${descrizione}</div>
    </div>
  `;
  drawerVisitLink.href = link;

  drawer.setAttribute('aria-hidden', 'false');
  drawerOverlay.setAttribute('aria-hidden', 'false');
  drawer.classList.add('open');
  drawerOverlay.classList.add('open');
  document.body.classList.add('no-scroll');

  // focus management
  setTimeout(() => btnBackToList.focus(), 10);
}

function closeDrawer() {
  drawer.classList.remove('open');
  drawerOverlay.classList.remove('open');
  drawer.setAttribute('aria-hidden', 'true');
  drawerOverlay.setAttribute('aria-hidden', 'true');
  document.body.classList.remove('no-scroll');

  // restituisco il focus alla card corrispondente (se presente)
  if (drawerIndexCorrente != null) {
    const card = document.querySelector(`.bando-card[data-index="${drawerIndexCorrente}"]`);
    if (card) card.focus();
  }
  drawerIndexCorrente = null;
}

// Interazioni overlay / pulsanti
drawerOverlay.addEventListener('click', closeDrawer);
btnBackToList.addEventListener('click', closeDrawer);
btnCloseDrawer.addEventListener('click', closeDrawer);

// Chiudi con ESC
window.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && drawer.classList.contains('open')) {
    closeDrawer();
  }
});

// Avvia il caricamento quando il DOM è pronto
window.addEventListener('DOMContentLoaded', () => {
  console.log('DOM pronto — avvio caricamento bandi');
  caricaBandi();
});
</script>
</body>
</html>
